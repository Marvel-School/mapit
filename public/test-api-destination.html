<!DOCTYPE html>
<html>
<head>
    <title>Test API Destination Creation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 20px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #cce7f0; color: #055160; border: 1px solid #abd5e5; }
        form { background: #f8f9fa; padding: 20px; border-radius: 5px; max-width: 500px; }
        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 3px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .form-row { display: flex; gap: 10px; }
        .form-row > div { flex: 1; }
    </style>
</head>
<body>
    <h1>Test API Destination Creation</h1>
    
    <form id="testForm">
        <h3>Create a Test Destination</h3>
        
        <div>
            <label>Destination Name *:</label>
            <input type="text" id="name" name="name" value="API Test Location" required>
        </div>
        
        <div class="form-row">
            <div>
                <label>City:</label>
                <input type="text" id="city" name="city" value="New York">
            </div>
            <div>
                <label>Country:</label>
                <select id="country" name="country">
                    <option value="">Select Country</option>
                    <option value="US" selected>United States</option>
                    <option value="CA">Canada</option>
                    <option value="GB">United Kingdom</option>
                </select>
            </div>
        </div>
        
        <div>
            <label>Description:</label>
            <textarea id="description" name="description" rows="3">A test location created via the API to verify the fix works properly.</textarea>
        </div>
        
        <div class="form-row">
            <div>
                <label>Status:</label>
                <select id="visited" name="visited">
                    <option value="0">Wishlist</option>
                    <option value="1" selected>Visited</option>
                </select>
            </div>
            <div>
                <label>Privacy:</label>
                <select id="privacy" name="privacy">
                    <option value="private" selected>Private</option>
                    <option value="public">Public</option>
                </select>
            </div>
        </div>
        
        <div id="visitDateContainer">
            <label>Visit Date:</label>
            <input type="date" id="visit_date" name="visit_date" value="2024-01-15">
        </div>
        
        <div>
            <label>Latitude:</label>
            <input type="number" id="latitude" name="latitude" value="40.7128" step="any" required>
        </div>
        
        <div>
            <label>Longitude:</label>
            <input type="number" id="longitude" name="longitude" value="-74.0060" step="any" required>
        </div>
        
        <button type="submit">Create Destination</button>
    </form>
    
    <div id="results"></div>
    
    <script>
        // Show/hide visit date based on status
        document.getElementById('visited').addEventListener('change', function() {
            const visitDateContainer = document.getElementById('visitDateContainer');
            visitDateContainer.style.display = this.value === '1' ? 'block' : 'none';
        });
        
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                city: formData.get('city'),
                country: formData.get('country'),
                description: formData.get('description'),
                visited: formData.get('visited'),
                visit_date: formData.get('visit_date'),
                privacy: formData.get('privacy'),
                latitude: parseFloat(formData.get('latitude')),
                longitude: parseFloat(formData.get('longitude'))
            };
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result info">Sending request...</div>';
            
            try {
                const response = await fetch('/api/destinations/quick-create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                let resultHTML = '<h3>API Response:</h3>';
                resultHTML += '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                
                if (result.success) {
                    resultHTML = '<div class="result success">✅ Success!</div>' + resultHTML;
                    
                    // Show what was actually created
                    if (result.data) {
                        resultHTML += '<h3>Created Destination:</h3>';
                        resultHTML += '<div class="result info">';
                        resultHTML += '<strong>Name:</strong> ' + (result.data.name || 'N/A') + '<br>';
                        resultHTML += '<strong>City:</strong> ' + (result.data.city || 'N/A') + '<br>';
                        resultHTML += '<strong>Country:</strong> ' + (result.data.country || 'N/A') + '<br>';
                        resultHTML += '<strong>Description:</strong> ' + (result.data.description || 'N/A') + '<br>';
                        resultHTML += '<strong>Visited:</strong> ' + (result.data.visited || '0') + '<br>';
                        resultHTML += '<strong>Privacy:</strong> ' + (result.data.privacy || 'N/A') + '<br>';
                        resultHTML += '<strong>Coordinates:</strong> ' + result.data.latitude + ', ' + result.data.longitude + '<br>';
                        resultHTML += '</div>';
                    }
                } else {
                    resultHTML = '<div class="result error">❌ Error: ' + (result.message || 'Unknown error') + '</div>' + resultHTML;
                }
                
                resultsDiv.innerHTML = resultHTML;
                
            } catch (error) {
                resultsDiv.innerHTML = '<div class="result error">❌ Network Error: ' + error.message + '</div>';
            }
        });
    </script>
</body>
</html>
